<% if host_param('kt_activation_keys') %>
<%#
name: subscription_manager_registration
snippet: true
model: ProvisioningTemplate
organizations:
- Default Organization
- OrgB
- OrgC
- OrgF
- OrgG
- this is very very very very very very very very very very very very very very very
  very very very long name
locations:
- LocA
- US/AWS
%>


  # add subscription manager
 <% if @host.operatingsystem.atomic? %>
  curl -s <%= subscription_manager_configuration_url(@host, false) %> | IS_ATOMIC=true bash
 <% else %>
  yum -t -y -e 0 install subscription-manager
  rpm -ivh <%= subscription_manager_configuration_url(@host) %>
 <% end %>

  echo "Registering the System"
  subscription-manager register --org="<%= @host.rhsm_organization_label %>" --name="<%= @host.name %>" --activationkey="<%= host_param('kt_activation_keys') %>"

  <% unless @host.operatingsystem.atomic? %>
    echo "Installing Katello Agent"
    yum -t -y -e 0 install katello-agent
    chkconfig goferd on
  <% end %>
<% end %>