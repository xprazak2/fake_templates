<%#
name: pxegrub2_discovery
snippet: true
model: ProvisioningTemplate
organizations:
- Default Organization
- Fritz1Org
- Fritz2Org
- Fritz3Org
- NewOrg
- OrgB
- OrgC
- OrgF
- OrgG
- this is very very very very very very very very very very very very very very very
  very very very long name
- Unassigned Organization
- WithOrgAdmin
locations:
- Fritz1Loc
- Fritz2Loc
- LocA
- NA/US/AWS
- WithHans
- WithHansAgain
-%>
<%#
RHEL 7 virtio driver does not have persistent naming scheme, causing interfaces
to be named eth0, eth1, etc.. If you want to enable the new persistent naming
scheme and get inteface names like ens3, add net.ifnames=1 to the linuxefi line
below. This will not be fixed until RHEL8 due to prevent breaking changes for
existing systems. See RHBZ#1259015 for more details.

Another bug in RHEL 7.4 is affecting $net_default_mac with a trailing slash, in
the global template we have a regexp module creating corrected variable $mac
which is used here. See RHBZ#1487107 for more info.
-%>
<%
  ["efi", ""].each do |suffix|
    ["/httpboot/", ""].each do |prefix|
%>
menuentry 'Foreman Discovery Image <%= prefix.tr('/','') %> <%= suffix %>' --id discovery<%= suffix %><%= prefix.tr('/','') %> {
  linux<%= suffix %> <%= prefix %>boot/fdi-image/vmlinuz0 rootflags=loop root=live:/fdi.iso rootfstype=auto ro rd.live.image acpi=force rd.luks=0 rd.md=0 rd.dm=0 rd.lvm=0 rd.bootif=0 rd.neednet=0 nokaslr nomodeset proxy.url=<%= foreman_server_url %> proxy.type=foreman BOOTIF=01-$mac
  initrd<%= suffix %> <%= prefix %>boot/fdi-image/initrd0.img
}
<%
    end
  end
%>
